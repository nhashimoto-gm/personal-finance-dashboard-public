# 📖 使用要領 / Usage Guide

Personal Finance Dashboardの詳細な使用方法をご説明します。

## 目次

1. [データ入力](#データ入力)
2. [マスター管理](#マスター管理)
3. [ダッシュボード集計期間変更](#ダッシュボード集計期間変更)
4. [その他の機能](#その他の機能)

---

## データ入力

### 概要

「Data Entry」タブから、日々の支出データを登録できます。

### 入力手順

1. **日付の選択**
   - 「日付」フィールドをクリックしてカレンダーから取引日を選択
   - デフォルトでは当日の日付が設定されています
   - 過去の日付も遡って入力可能です

2. **金額の入力**
   - 「金額」フィールドに支出額を入力
   - 数値のみ入力可能（1円以上の金額が必須）
   - ¥記号は自動的に表示されます

3. **ショップの選択**
   - 「ショップ」ドロップダウンをクリック
   - **インクリメンタルサーチ機能**: キーボードで文字を入力すると、該当するショップが絞り込まれます
   - リストから該当するショップを選択
   - 新しいショップを追加したい場合は、[マスター管理](#マスター管理)を参照

4. **カテゴリの選択**
   - 「カテゴリ」ドロップダウンをクリック
   - **インクリメンタルサーチ機能**: キーボードで文字を入力すると、該当するカテゴリが絞り込まれます
   - リストから該当するカテゴリを選択
   - 新しいカテゴリを追加したい場合は、[マスター管理](#マスター管理)を参照

5. **登録**
   - 「取引を追加」ボタンをクリック
   - 成功すると、画面上部に成功メッセージが表示されます
   - 入力した取引はダッシュボードの取引履歴に即座に反映されます

### 入力ガイド

画面右側に表示される「入力ガイド」カードには、各フィールドの入力要件が記載されています：

- **日付**: 取引日を選択してください
- **金額**: 0より大きい金額を入力してください
- **ショップ/カテゴリ**: ドロップダウンリストから選択してください

### バリデーション

以下の項目はすべて必須入力です：

- ✅ 日付
- ✅ 金額（1円以上）
- ✅ ショップ
- ✅ カテゴリ

いずれかが未入力の場合、登録ボタンをクリックしてもエラーメッセージが表示されます。

### ヒント

- セッション情報により、前回選択したショップとカテゴリが記憶されます
- 連続して同じショップ・カテゴリのデータを入力する際に便利です

---

## マスター管理

### 概要

「Master」タブから、ショップとカテゴリのマスターデータを管理できます。

### ショップの追加

1. **追加ボタンをクリック**
   - 「ショップ管理」カードの右上にある「追加」ボタンをクリック

2. **ショップ名を入力**
   - 表示されたダイアログにショップ名を入力
   - 例: 「セブンイレブン」「Amazon」「スターバックス」など

3. **確定**
   - OKボタンをクリックして登録
   - 登録したショップが「登録済みショップ」リストに即座に追加されます
   - データ入力画面のショップドロップダウンにも反映されます

### カテゴリの追加

1. **追加ボタンをクリック**
   - 「カテゴリ管理」カードの右上にある「追加」ボタンをクリック

2. **カテゴリ名を入力**
   - 表示されたダイアログにカテゴリ名を入力
   - 例: 「食費」「交通費」「娯楽」「光熱費」など

3. **確定**
   - OKボタンをクリックして登録
   - 登録したカテゴリが「登録済みカテゴリ」リストに即座に追加されます
   - データ入力画面のカテゴリドロップダウンにも反映されます

### 登録済みデータの確認

- **ショップリスト**: 「登録済みショップ」セクションに全ショップが一覧表示されます
- **カテゴリリスト**: 「登録済みカテゴリ」セクションに全カテゴリが一覧表示されます

### 注意事項

- 現在のバージョンでは、追加したマスターデータの編集・削除機能はUI上に実装されていません
- データベースから直接操作する必要があります
- 重複したショップ名・カテゴリ名を登録することは避けてください

---

## ダッシュボード集計期間変更

### 概要

「Dashboard」タブでは、任意の期間を指定して支出データを集計・分析できます。

### 基本的な期間設定

#### 1. 開始日・終了日の指定

1. **期間選択フォームを使用**
   - ダッシュボード上部のカードに表示される期間選択フォームを使用

2. **開始日を設定**
   - 「開始日」フィールドをクリックしてカレンダーから日付を選択
   - デフォルトでは30日前の日付が設定されています

3. **終了日を設定**
   - 「終了日」フィールドをクリックしてカレンダーから日付を選択
   - デフォルトでは当日の日付が設定されています

4. **絞り込みボタンをクリック**
   - 検索ボタン（虫眼鏡アイコン）をクリック
   - 指定した期間のデータが再集計されます

#### 2. リセット機能

- **リセットボタン**をクリックすると、デフォルト期間（過去30日間）に戻ります
- クエリパラメータもクリアされ、ページが再読み込みされます

### サマリー統計の表示

期間を設定すると、4つの統計カードが自動的に更新されます：

1. **期間合計**: 指定期間内の総支出額
2. **1日平均**: データがある日数の平均支出額
3. **レコード数**: 期間内の取引件数
4. **取引ショップ数**: 期間内にデータが存在するユニークなショップ数

### グラフの表示

以下のグラフが自動的に更新されます：

1. **ショップ別支出（円グラフ）**
   - 全体の4%以上を占めるショップを個別表示
   - 4%未満のショップは「その他」にまとめられます

2. **カテゴリTOP10（棒グラフ）**
   - 支出額上位10カテゴリを表示

3. **日別支出推移（折れ線グラフ）**
   - 期間内の日別支出の推移を表示

4. **日別累積支出推移（折れ線グラフ）**
   - 期間内の累積支出の推移を表示

### 期間別推移グラフの切り替え

#### 概要

より長期的なトレンドを分析するため、期間別推移グラフでは複数の表示モードが用意されています。

#### 切り替え方法

1. **ボタンの位置**
   - 「Monthly Expense Trend」カードの右上にボタングループが表示されています

2. **表示モードの選択**
   - **12ヶ月ボタン**: 過去12ヶ月の月別支出を表示
   - **2年ボタン**: 過去2年（24ヶ月）の月別支出を表示
   - **5年ボタン**: 過去5年（60ヶ月）の月別支出を表示
   - **10年ボタン**: 過去10年（120ヶ月）の月別支出を表示

3. **自動スクロール**
   - ボタンをクリックすると、期間別推移グラフにページが自動スクロールします
   - 選択されたボタンは青色（プライマリカラー）にハイライトされます

#### グラフの特徴

- **積み上げ棒グラフ**: 各期間の支出をカテゴリ別に色分けして表示
- **カテゴリ凡例**: グラフ下部に表示され、クリックで表示/非表示を切り替え可能
- **ツールチップ**: バーにマウスオーバーすると、詳細な金額が表示されます

#### 使用例

```
例1: 過去1年間の月別トレンドを確認したい
→ 「12ヶ月」ボタンをクリック

例2: 長期的な支出パターンを分析したい
→ 「5年」または「10年」ボタンをクリック

例3: 最近2年間の季節変動を確認したい
→ 「2年」ボタンをクリック
```

### 取引履歴のフィルタリング

ダッシュボード下部に表示される取引履歴テーブルでは、さらに詳細なフィルタリングが可能です：

1. **ショップバッジをクリック**
   - 取引履歴のショップ名（バッジ）をクリック
   - そのショップの取引のみが検索結果として表示されます

2. **カテゴリ名をクリック**
   - 取引履歴のカテゴリ名をクリック
   - そのカテゴリの取引のみが検索結果として表示されます

3. **検索結果のクリア**
   - 検索結果セクションの「×」ボタンをクリックして元に戻せます

---

## その他の機能

### 言語切り替え

1. **言語切り替えボタン**
   - ナビゲーションバー右上の「EN/JP」ボタンをクリック

2. **切り替え動作**
   - 英語（EN）と日本語（JA）を即座に切り替え
   - すべてのラベル、ボタン、メッセージが翻訳されます
   - グラフのタイトルや軸ラベルも更新されます

### ダークモード

1. **ダークモード切り替え**
   - ナビゲーションバー右上の月/太陽アイコンをクリック

2. **自動適用**
   - ページ全体のテーマがダークモードに切り替わります
   - カード、テーブル、フォームなどすべての要素が調整されます
   - **Highchartsのテーマも自動的に切り替わります**
   - グラフの背景色、文字色、凡例色がダークモードに最適化されます

3. **設定の保存**
   - 選択したテーマはローカルストレージに保存されます
   - 次回アクセス時にも同じテーマが適用されます

### レスポンシブデザイン

- **モバイル対応**: スマートフォンやタブレットでも快適に利用可能
- **自動調整**: 画面サイズに応じてレイアウトが最適化されます
- **タッチ操作**: モバイルデバイスでのタッチ操作に対応

### インタラクティブグラフ

すべてのグラフは以下の操作が可能です：

1. **凡例クリック**: 凡例項目をクリックしてデータの表示/非表示を切り替え
2. **ズーム**: マウスドラッグでズームイン（折れ線グラフ）
3. **ツールチップ**: マウスオーバーで詳細データを表示
4. **エクスポート**: グラフ上の右クリックメニューから画像保存が可能（Highcharts標準機能）

---

## よくある質問（FAQ）

### Q1: データを間違えて入力してしまいました。削除や編集はできますか？

A: はい、可能です。ダッシュボードの取引履歴テーブルで、各取引の右側に「編集」と「削除」ボタンが表示されています。
- **編集**: 編集ボタンをクリックすると、取引の詳細を修正できます
- **削除**: 削除ボタンをクリックすると、確認ダイアログが表示され、取引を削除できます

### Q2: グラフが表示されません。

A: 以下を確認してください：
- JavaScriptが有効になっているか
- Highchartsライブラリが正しく読み込まれているか
- ブラウザのコンソールにエラーが表示されていないか

### Q3: マスターデータ（ショップ・カテゴリ）を削除できますか？

A: 現在のバージョンでは、UI上での削除機能は実装されていません。データベースから直接削除する必要があります。ただし、既存の取引データで使用されているマスターデータを削除すると、データ整合性に問題が生じる可能性がありますのでご注意ください。

### Q4: CSVエクスポート機能はありますか？

A: はい、実装されています。ダッシュボード上部の「エクスポート」ボタンをクリックすると、表示中の取引データをCSV形式でダウンロードできます。エクスポートされたファイルはExcelでも開くことができます（UTF-8 BOM対応）。

### Q5: 複数ユーザーで使用できますか？

A: 現在のバージョンは単一ユーザー向けです。ユーザー認証とマルチユーザー対応はVersion 1.2で実装予定です。

---

## トラブルシューティング

### データが保存されない

- データベース接続設定（`.env_db`）を確認してください
- MySQLサーバーが起動しているか確認してください
- データベースユーザーに適切な権限があるか確認してください

### グラフが正しく表示されない

- ブラウザのJavaScriptが有効になっているか確認してください
- ブラウザのキャッシュをクリアしてみてください
- 別のブラウザで試してみてください

### ダークモードが機能しない

- ブラウザのローカルストレージが有効になっているか確認してください
- ページを再読み込みしてみてください

### 期間選択が反映されない

- 開始日が終了日より前になっているか確認してください
- 「絞り込み」ボタンをクリックしたか確認してください
- URLにクエリパラメータが正しく含まれているか確認してください

---

## サポート

問題が解決しない場合は、以下をご利用ください：

- [GitHubイシュー](https://github.com/YOUR_USERNAME/Personal-Finance-Dashboard/issues)
- [GitHubディスカッション](https://github.com/YOUR_USERNAME/Personal-Finance-Dashboard/discussions)

---

[⬆ トップに戻る](#-使用要領--usage-guide)
